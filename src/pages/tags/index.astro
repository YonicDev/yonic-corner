---
import { getCollection } from "astro:content";

import Layout from "@lib/layouts/Layout.astro";
import Tag from "@lib/components/Tag.astro";

const posts = (await getCollection("blog"))
    .filter(post => !post.data.draft);

const allTags = posts.flatMap(post => post.data.tags);
const tags = [...new Set(allTags)].sort((a, b) => a.localeCompare(b));
const occurrences: Record<string, number> = {};

for (const tag of tags) {
    occurrences[tag] = allTags.reduce((acc, tag2) => acc += tag2 === tag? 1 : 0, 0);
}

---

<Layout title="All tags">
    <div class="container">
        <h1>Tags</h1>
        { tags.map(tag => <Tag {tag} total={occurrences[tag]} />) }
    </div>
</Layout>

<style lang="scss">
    @use "../../styles/util.scss";

    .container {
        background-color: var(--article-color);
        border: 4px solid var(--emphasis-color);
        box-shadow: util.extrude(8);
        margin: 1rem auto;
        padding: 1rem;
        width: 75%;
        h1 {
            margin: 1rem 0;
        }
        a {
            display: inline-flex;
            background-color: var(--base-color);
            color: var(--emphasis-color);
            padding: 5px 10px;
            border-radius: 10px;
            margin: 1rem 0.25rem;
            &:hover {
                color: var(--emphasis-color);
            }
        }
    }
</style>